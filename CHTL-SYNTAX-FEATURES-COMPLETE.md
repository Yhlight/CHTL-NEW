# CHTL完整语法特征记录

## 📖 基于四个基本文件的完整语法特征分析

### 1. 基础语法结构
- **注释系统**: `//`(单行), `/**/`(多行), `--`(生成器注释)
- **字面量系统**: 双引号`""`, 单引号`''`, 无修饰字面量
- **CE对等式**: `:`与`=`完全等价
- **块结构**: `{}`大括号块结构

### 2. 元素与属性系统
- **HTML元素**: 支持所有HTML元素
- **属性语法**: `属性名 : "属性值";`
- **文本节点**: `text { }` 语法

### 3. 局部样式系统 ⭐
- **内联样式**: `style { width: 100px; }`
- **自动化类名**: `.box` → 自动添加`class="box"`
- **自动化ID**: `#box` → 自动添加`id="box"`
- **上下文引用**: `&` (局部style优先class)
- **伪类/伪元素**: `&:hover`, `&::before`
- **自动添加规则**:
  - 多组类选择器时自动添加第一个
  - 多组id选择器时自动添加第一个
  - 选择器代码自动添加到全局样式块

### 4. 模板系统
- **样式组模板**: `[Template] @Style 组名 { }`
- **元素模板**: `[Template] @Element 元素名 { }`
- **变量组模板**: `[Template] @Var 变量组名 { }`
- **继承机制**: `@Style 模板名;`, `inherit @Style 模板名;`
- **变量引用**: `ThemeColor(tableColor)`

### 5. 自定义系统
- **自定义样式组**: `[Custom] @Style 名称 { }`
- **无值样式组**: `color, font-size;`
- **特例化**: `@Style TextSet { color: red; }`
- **删除操作**: `delete 属性名`, `delete @Style 继承名`
- **索引访问**: `div[1]`
- **插入操作**: `insert after/before/replace/at top/at bottom`

### 6. 原始嵌入系统
- **基本类型**: `[Origin] @Html/@Style/@JavaScript { }`
- **带名嵌入**: `[Origin] @Html 名称 { }`
- **自定义类型**: `[Origin] @Vue 名称 { }` (动态创建)
- **直接输出**: 内容不被CHTL处理

### 7. 导入系统
- **基础导入**: `[Import] @Html from 路径 as 名称`
- **as语法规则**:
  - `@Html/@Style/@JavaScript`: 无as跳过，有as创建带名原始嵌入节点
  - 其他类型: as可选
- **路径搜索**: 官方模块→当前module→当前目录
- **通配符**: `.*`, `/*.cmod`等

### 8. 配置系统
- **基础配置**: `[Configuration] { }`
- **命名配置**: `[Configuration] @Config 名称 { }`
- **Name配置**: 关键字重定义
- **OriginType配置**: 自定义原始嵌入类型
- **自动化配置**: `DISABLE_STYLE_AUTO_ADD_CLASS`等

### 9. 命名空间系统
- **基础语法**: `[Namespace] 名称`
- **嵌套语法**: `space.room.subroom`
- **使用语法**: `@Element Box from space;`
- **自动合并**: 同名命名空间合并
- **默认命名空间**: 文件名作为默认命名空间

### 10. 约束系统
- **精确约束**: `except span, [Custom] @Element Box;`
- **类型约束**: `except @Html;`, `except [Custom];`
- **全局约束**: 命名空间内使用

### 11. CHTL JS系统（独立）
- **模块加载**: `module { load: 路径, }`
- **选择器**: `{{选择器}}`系列
- **链式访问**: `->` 代替 `.`
- **事件监听**: `{{选择器}}->listen { }`
- **事件委托**: `{{选择器}}->delegate { }`
- **动画**: `animate { }`
- **虚对象**: `vir 名称 = 函数 { }`
- **事件绑定**: `{{选择器}} &-> 事件 { }`
- **util表达式**: `util 条件 -> change { } -> then { }`

### 12. 语法约束边界
- **局部样式块**: 允许模板变量、自定义变量、样式组、delete操作、继承、注释、原始嵌入
- **局部script**: 允许模板变量、自定义变量组、命名空间from、注释、原始嵌入、`{{&}}`等
- **全局样式块**: 与局部样式块相同语法
- **其他script**: 仅允许注释和原始嵌入

### 13. 自动化规则
- **局部style**: `&`优先选择class，自动添加类选择器
- **局部script**: `&`优先选择id，`{{.box}}`和`{{#box}}`触发自动添加
- **配置控制**: 通过`DISABLE_*`配置项控制自动化行为

## 🎯 第二阶段开发计划

基于完整的语法特征记录，现在进入第二阶段：**样式相关节点实现**

### 核心任务：
1. **StyleNode** - 局部样式块节点
2. **CSS选择器自动化** - `.box`、`#box`、`&`处理
3. **内联样式处理** - 直接CSS属性
4. **全局样式块分离** - 选择器代码自动添加到全局
5. **配置驱动的自动化** - 根据配置启用/禁用自动化

这个阶段是CHTL最核心的特性，我将严格按照语法文档实现，确保：
- 完全分离CHTL和CHTL JS
- 严格遵循自动化规则
- 正确处理&引用选择器
- 准确实现选择器优先级规则