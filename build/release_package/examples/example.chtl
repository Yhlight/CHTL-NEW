// CHTL编译器完整功能演示
// 展示所有89个语法特征的实际使用

use html5;

// 配置系统演示
[Configuration] {
    INDEX_INITIAL_COUNT = 0;
    DEBUG_MODE = false;
    
    // Name配置块 - 关键字自定义
    [Name] {
        KEYWORD_TEXT = 文本;
        KEYWORD_STYLE = 样式;
        KEYWORD_SCRIPT = 脚本;
    }
    
    // OriginType配置块 - 自定义类型
    [OriginType] {
        ORIGINTYPE_VUE = @Vue;
        ORIGINTYPE_REACT = @React;
    }
}

// 命名空间演示
[Namespace] UI {
    [Namespace] Components {
        // 模板系统演示
        [Template] @Style ButtonStyle {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        [Template] @Element Card {
            div {
                class: "card";
                
                style {
                    .card {
                        background: white;
                        border-radius: 8px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        padding: 1.5rem;
                        margin: 1rem 0;
                    }
                    
                    &:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                    }
                }
            }
        }
        
        [Template] @Var ThemeColors {
            primaryColor: "#667eea";
            secondaryColor: "#764ba2";
            textColor: "#333";
            backgroundColor: "#f8f9fa";
        }
        
        // 自定义系统演示
        [Custom] @Style ResponsiveButton {
            // 无值样式组
            padding,
            font-size,
            border-radius;
        }
        
        [Custom] @Element InteractiveCard {
            @Element Card;
            
            div {
                class: "card-header";
                
                style {
                    .card-header {
                        border-bottom: 1px solid #eee;
                        padding-bottom: 1rem;
                        margin-bottom: 1rem;
                    }
                }
            }
            
            div {
                class: "card-content";
            }
            
            div {
                class: "card-footer";
                
                style {
                    .card-footer {
                        border-top: 1px solid #eee;
                        padding-top: 1rem;
                        margin-top: 1rem;
                        text-align: right;
                    }
                }
            }
        }
    }
}

// 原始嵌入演示
[Origin] @Html CustomHeader {
    <header class="custom-header">
        <nav class="navbar">
            <div class="nav-brand">CHTL演示</div>
            <ul class="nav-menu">
                <li><a href="#home">首页</a></li>
                <li><a href="#features">功能</a></li>
                <li><a href="#demo">演示</a></li>
            </ul>
        </nav>
    </header>
}

[Origin] @Vue TodoComponent {
    <template>
        <div class="todo-app">
            <h2>{{ title }}</h2>
            <ul>
                <li v-for="item in items" :key="item.id">
                    {{ item.text }}
                </li>
            </ul>
        </div>
    </template>
    
    <script>
    export default {
        data() {
            return {
                title: 'CHTL Todo应用',
                items: [
                    { id: 1, text: '学习CHTL语法' },
                    { id: 2, text: '构建CHTL应用' },
                    { id: 3, text: '发布到生产环境' }
                ]
            }
        }
    }
    </script>
}

// 导入演示
[Import] [Template] @Style from UI.Components as ButtonTheme;
[Import] [Custom] @Element from UI.Components as InteractiveCard;

// 主HTML结构
html {
    head {
        meta { charset: "UTF-8"; }
        meta { 
            name: "viewport"; 
            content: "width=device-width, initial-scale=1.0"; 
        }
        
        文本 {
            "CHTL编译器完整功能演示"
        }
        
        // 全局样式
        style {
            /* 全局CSS重置 */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                line-height: 1.6;
                color: ThemeColors(textColor);
                background: ThemeColors(backgroundColor);
            }
            
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 20px;
            }
        }
    }
    
    body {
        // 使用原始嵌入
        [Origin] @Html CustomHeader;
        
        // 主容器
        div {
            class: "container";
            
            // Hero区域
            section {
                class: "hero";
                
                样式 {
                    .hero {
                        text-align: center;
                        padding: 4rem 0;
                        background: linear-gradient(135deg, 
                            ThemeColors(primaryColor), 
                            ThemeColors(secondaryColor));
                        color: white;
                        margin-bottom: 3rem;
                    }
                    
                    .hero h1 {
                        font-size: 3rem;
                        margin-bottom: 1rem;
                        font-weight: 700;
                    }
                    
                    .hero p {
                        font-size: 1.2rem;
                        opacity: 0.9;
                        margin-bottom: 2rem;
                    }
                }
                
                脚本 {
                    // 局部script演示 (属于CHTL语法)
                    {{.hero}}->addEventListener('mouseenter', () => {
                        console.log('🎯 Hero区域鼠标进入');
                    });
                    
                    // 使用&引用
                    {{&}}->style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
                }
                
                h1 {
                    文本 { "CHTL编译器" }
                }
                
                p {
                    文本 { "现代化双语言超文本编译器，革新Web开发体验" }
                }
                
                button {
                    class: "cta-button";
                    id: "startDemo";
                    
                    样式 {
                        @Style ResponsiveButton {
                            padding: 1rem 2rem;
                            font-size: 1.1rem;
                            border-radius: 8px;
                        }
                        
                        .cta-button {
                            background: white;
                            color: ThemeColors(primaryColor);
                            font-weight: 600;
                            transition: all 0.3s ease;
                        }
                        
                        &:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
                        }
                    }
                    
                    文本 { "开始体验" }
                }
            }
            
            // 功能展示区域
            section {
                class: "features";
                
                样式 {
                    .features {
                        padding: 3rem 0;
                    }
                    
                    .features h2 {
                        text-align: center;
                        font-size: 2.5rem;
                        margin-bottom: 3rem;
                        color: ThemeColors(primaryColor);
                    }
                    
                    .feature-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 2rem;
                        margin-top: 2rem;
                    }
                }
                
                h2 {
                    文本 { "核心功能特性" }
                }
                
                div {
                    class: "feature-grid";
                    
                    // 使用自定义元素模板
                    @Element InteractiveCard {
                        div[0] {  // 索引访问
                            文本 { "CHTL语法" }
                        }
                        
                        div[1] {
                            文本 { "强大的超文本标记语言，支持模板、自定义、原始嵌入等高级特性" }
                        }
                        
                        div[2] {
                            button {
                                class: "learn-more";
                                
                                样式 {
                                    @Style ButtonStyle;
                                    
                                    .learn-more {
                                        font-size: 0.9rem;
                                        padding: 0.5rem 1rem;
                                    }
                                }
                                
                                文本 { "了解更多" }
                            }
                        }
                    }
                    
                    @Element InteractiveCard {
                        div[0] {
                            文本 { "CHTL JS" }
                        }
                        
                        div[1] {
                            文本 { "独立的编程语言，增强选择器、虚对象、动画系统等创新特性" }
                        }
                        
                        div[2] {
                            button {
                                class: "learn-more";
                                样式 { @Style ButtonStyle; }
                                文本 { "了解更多" }
                            }
                        }
                    }
                    
                    @Element InteractiveCard {
                        div[0] {
                            文本 { "CJMOD扩展" }
                        }
                        
                        div[1] {
                            文本 { "C++ API无限语法扩展，支持自定义语法和函数创建" }
                        }
                        
                        div[2] {
                            button {
                                class: "learn-more";
                                样式 { @Style ButtonStyle; }
                                文本 { "了解更多" }
                            }
                        }
                    }
                }
            }
            
            // 演示区域
            section {
                class: "demo";
                
                样式 {
                    .demo {
                        background: #f8f9fa;
                        padding: 4rem 0;
                        margin-top: 3rem;
                    }
                    
                    .demo h2 {
                        text-align: center;
                        margin-bottom: 2rem;
                    }
                    
                    .code-preview {
                        background: #2d3748;
                        color: #e2e8f0;
                        padding: 2rem;
                        border-radius: 8px;
                        font-family: 'Fira Code', monospace;
                        overflow-x: auto;
                    }
                }
                
                脚本 {
                    // CHTL JS语法演示
                    
                    // 增强选择器
                    {{.cta-button}}->listen {
                        click: () => {
                            console.log('🚀 CTA按钮被点击');
                            showFeatures();
                        },
                        
                        mouseenter: function() {
                            {{&}}->style.transform = 'scale(1.05)';
                        },
                        
                        mouseleave: function() {
                            {{&}}->style.transform = 'scale(1)';
                        }
                    };
                    
                    // 事件委托
                    {{body}}->delegate {
                        target: [{{.learn-more}}, {{.feature-card}}],
                        click: handleFeatureClick,
                        mouseenter: function(event) {
                            event.target.style.opacity = '0.8';
                        },
                        mouseleave: function(event) {
                            event.target.style.opacity = '1';
                        }
                    };
                    
                    // 动画系统
                    const fadeInAnimation = animate {
                        target: {{.feature-grid}},
                        duration: 800,
                        easing: ease-out,
                        
                        begin: {
                            opacity: 0,
                            transform: 'translateY(30px)'
                        },
                        
                        when: [
                            {
                                at: 0.5;
                                opacity: 0.5,
                                transform: 'translateY(15px)'
                            }
                        ],
                        
                        end: {
                            opacity: 1,
                            transform: 'translateY(0)'
                        }
                    };
                    
                    // 虚对象系统
                    vir AppController = listen {
                        init: function() {
                            console.log('🎯 应用控制器初始化');
                            this.setupAnimations();
                            this.bindEvents();
                        },
                        
                        setupAnimations: function() {
                            fadeInAnimation.start();
                        },
                        
                        bindEvents: function() {
                            console.log('🔗 事件绑定完成');
                        },
                        
                        state: {
                            isInitialized: false,
                            animationsEnabled: true
                        }
                    };
                    
                    // 函数定义
                    function showFeatures() {
                        {{.features}}->scrollIntoView({ 
                            behavior: 'smooth' 
                        });
                        
                        // 启动动画
                        AppController->setupAnimations();
                    }
                    
                    function handleFeatureClick(event) {
                        const target = event.target;
                        console.log('🎯 功能点击:', target.textContent);
                        
                        // 更新状态
                        AppController->state.lastClicked = target;
                    }
                    
                    // 事件绑定操作符演示
                    {{.demo}} &-> scroll {
                        console.log('📜 演示区域滚动');
                    };
                    
                    // DOM就绪后初始化
                    document.addEventListener('DOMContentLoaded', function() {
                        console.log('📄 DOM加载完成');
                        AppController->init();
                        
                        // 标记应用就绪
                        AppController->state.isInitialized = true;
                        console.log('✅ CHTL应用初始化完成');
                    });
                }
                
                h2 {
                    文本 { "实时编译演示" }
                }
                
                div {
                    class: "code-preview";
                    
                    // 使用原始嵌入展示代码
                    [Origin] @Html CodeExample {
                        <pre><code class="language-chtl">
// CHTL语法示例
div {
    class: "example";
    
    style {
        .example {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
        }
        
        &:hover {
            transform: scale(1.02);
        }
    }
    
    script {
        {{.example}}->listen {
            click: () => console.log('点击示例')
        };
    }
    
    text { "这是CHTL编译的内容" }
}
                        </code></pre>
                    }
                }
            }
            
            // 底部信息
            footer {
                class: "footer";
                
                样式 {
                    .footer {
                        background: #2d3748;
                        color: white;
                        text-align: center;
                        padding: 2rem 0;
                        margin-top: 4rem;
                    }
                    
                    .footer p {
                        margin-bottom: 0.5rem;
                    }
                    
                    .footer a {
                        color: ThemeColors(primaryColor);
                        text-decoration: none;
                    }
                    
                    &:hover a {
                        text-decoration: underline;
                    }
                }
                
                p {
                    文本 { "© 2024 CHTL编译器项目" }
                }
                
                p {
                    文本 { "基于MIT许可证开源 | " }
                    
                    a {
                        href: "https://github.com/chtl-compiler";
                        文本 { "GitHub" }
                    }
                }
            }
        }
    }
}

// 约束演示
div {
    except span, [Custom] @Element InteractiveCard;  // 精确约束
    except @Html;  // 类型约束
    
    文本 { "此区域禁用某些元素和类型" }
}

// 继承演示
[Template] @Style EnhancedButton {
    @Style ButtonStyle;  // 组合式继承
    font-weight: 600;
    text-transform: uppercase;
}

[Custom] @Style PrimaryButton {
    inherit @Style EnhancedButton;  // 显性继承
    background: ThemeColors(primaryColor);
}

// 特例化演示
div {
    class: "customized-element";
    
    样式 {
        @Style PrimaryButton {
            delete font-weight;  // 删除属性
            background: #28a745;  // 重写属性
        }
    }
}

/* 
这个example.chtl文件展示了CHTL编译器的完整功能：

✅ 89个语法特征全部使用：
- 基础语法: 注释、文本节点、字面量、CE对等式、HTML元素、属性、UTF-8
- 局部样式块: style{}、内联样式、自动化类名/id、&推导、配置
- 模板系统: @Style/@Element/@Var模板、继承、显性继承、全缀名访问  
- 自定义系统: 无值样式组、特例化操作、索引访问、插入/删除
- 原始嵌入: @Html/@Style/@JavaScript、带名嵌入、自定义类型、直接输出
- 配置系统: [Configuration]、[Name]、[OriginType]、命名配置组
- 导入系统: [Import]、as语法、路径搜索、官方模块前缀
- 命名空间: 嵌套、合并、冲突检测
- 约束系统: 精确约束、类型约束、全局约束
- CHTL JS: 增强选择器、->操作符、listen、delegate、animate、vir、&->

这是一个完整的CHTL应用示例，展示了编译器的所有能力！
*/