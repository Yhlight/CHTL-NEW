;; ç‚æœµè‰æš–è‰²ç¬”è®°
;; ä¸¥æ ¼æŒ‰ç…§CHTLè¯­æ³•æ–‡æ¡£è¦æ±‚å®ç°

[Template] @Element ChthollyWarmNote
{
    div
    {
        class: chtholly-warm-note;
        
        style
        {
            .chtholly-warm-note
            {
                background: linear-gradient(135deg, #FFF8DC 0%, #FFEBCD 50%, @Var ChthollyColors.warm-pink 100%);
                border: 2px solid @Var ChthollyColors.primary-red;
                border-radius: 15px;
                padding: @Var ChthollySpacing.large;
                box-shadow: 0 8px 25px rgba(255, 107, 107, 0.2);
                font-family: @Var ChthollyFonts.primary-font;
                position: relative;
                max-width: 400px;
                margin: @Var ChthollySpacing.medium auto;
            }
            
            .note-header
            {
                background: linear-gradient(45deg, @Var ChthollyColors.primary-red, @Var ChthollyColors.emerald-green);
                color: white;
                padding: @Var ChthollySpacing.medium;
                margin: -@Var ChthollySpacing.large -@Var ChthollySpacing.large @Var ChthollySpacing.medium -@Var ChthollySpacing.large;
                border-radius: 13px 13px 0 0;
                text-align: center;
                font-weight: bold;
            }
            
            .note-editor
            {
                background: transparent;
                border: none;
                width: 100%;
                min-height: 200px;
                font-family: @Var ChthollyFonts.primary-font;
                font-size: 14px;
                line-height: 1.6;
                color: #8B4B8B;
                resize: vertical;
                outline: none;
            }
            
            .note-toolbar
            {
                display: flex;
                gap: @Var ChthollySpacing.small;
                margin-top: @Var ChthollySpacing.medium;
                padding-top: @Var ChthollySpacing.medium;
                border-top: 1px solid @Var ChthollyColors.primary-red;
            }
            
            .note-btn
            {
                background: @Var ChthollyColors.emerald-green;
                color: white;
                border: none;
                border-radius: 15px;
                padding: @Var ChthollySpacing.small @Var ChthollySpacing.medium;
                cursor: pointer;
                font-size: 12px;
                transition: all 0.3s ease;
            }
            
            .note-btn:hover
            {
                background: @Var ChthollyColors.primary-red;
                transform: translateY(-1px);
            }
        }
        
        script
        {
            ;; ç‚æœµè‰æš–è‰²ç¬”è®°é€»è¾‘
            console.log('ğŸ“” ç‚æœµè‰çš„æš–è‰²ç¬”è®°å‡†å¤‡å°±ç»ª');
            
            const note = {{.chtholly-warm-note}};
            const noteId = 'chtholly_note_' + (@NoteId || Date.now());
            
            ;; åˆ›å»ºç¬”è®°ç•Œé¢
            note.innerHTML = `
                <div class="note-header">ğŸŒ¸ ç‚æœµè‰çš„æš–è‰²ç¬”è®° ğŸŒ¸</div>
                <textarea class="note-editor" placeholder="è®°å½•ç‚æœµè‰çš„æ¸©æš–æ—¶å…‰..."></textarea>
                <div class="note-toolbar">
                    <button class="note-btn save-btn">ğŸ’¾ ä¿å­˜</button>
                    <button class="note-btn format-btn">âœ¨ æ ¼å¼åŒ–</button>
                    <button class="note-btn clear-btn">ğŸ§¹ æ¸…ç©º</button>
                    <button class="note-btn export-btn">ğŸ“¤ å¯¼å‡º</button>
                </div>
            `;
            
            const editor = note.querySelector('.note-editor');
            const saveBtn = note.querySelector('.save-btn');
            const formatBtn = note.querySelector('.format-btn');
            const clearBtn = note.querySelector('.clear-btn');
            const exportBtn = note.querySelector('.export-btn');
            
            ;; ä¿å­˜åŠŸèƒ½
            saveBtn &-> click {
                localStorage.setItem(noteId, editor.value);
                console.log('ğŸ’– ç‚æœµè‰æš–è‰²ç¬”è®°å·²ä¿å­˜');
                
                ;; ä¿å­˜åé¦ˆ
                saveBtn.textContent = 'âœ… å·²ä¿å­˜';
                setTimeout(() => {
                    saveBtn.textContent = 'ğŸ’¾ ä¿å­˜';
                }, 1500);
            };
            
            ;; æ ¼å¼åŒ–åŠŸèƒ½
            formatBtn &-> click {
                const content = editor.value;
                const formatted = content
                    .split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0)
                    .join('\n\n');
                
                editor.value = formatted;
                console.log('âœ¨ ç‚æœµè‰ç¬”è®°å·²æ ¼å¼åŒ–');
            };
            
            ;; æ¸…ç©ºåŠŸèƒ½
            clearBtn &-> click {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºç‚æœµè‰çš„æš–è‰²ç¬”è®°å—ï¼Ÿ')) {
                    editor.value = '';
                    localStorage.removeItem(noteId);
                    console.log('ğŸ§¹ ç‚æœµè‰æš–è‰²ç¬”è®°å·²æ¸…ç©º');
                }
            };
            
            ;; å¯¼å‡ºåŠŸèƒ½
            exportBtn &-> click {
                const content = editor.value;
                if (content.trim()) {
                    const blob = new Blob([content], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'chtholly_note_' + new Date().toISOString().slice(0, 10) + '.txt';
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    console.log('ğŸ“¤ ç‚æœµè‰æš–è‰²ç¬”è®°å·²å¯¼å‡º');
                } else {
                    console.log('ğŸ“ ç¬”è®°å†…å®¹ä¸ºç©ºï¼Œæ— æ³•å¯¼å‡º');
                }
            };
            
            ;; åŠ è½½å·²ä¿å­˜çš„ç¬”è®°
            const savedNote = localStorage.getItem(noteId);
            if (savedNote) {
                editor.value = savedNote;
                console.log('ğŸ“– åŠ è½½ç‚æœµè‰çš„æš–è‰²ç¬”è®°');
            }
            
            ;; è‡ªåŠ¨ä¿å­˜
            let autoSaveTimer;
            editor &-> input {
                clearTimeout(autoSaveTimer);
                autoSaveTimer = setTimeout(() => {
                    localStorage.setItem(noteId, editor.value);
                }, 3000);
            };
        }
    }
}