// CJMODå¼ºå¤§ç‰¹å¾æ¼”ç¤º - ä¸¥æ ¼æŒ‰CJMODæ–‡æ¡£

[Import] @CJmod from Chtholly

// printMyloveåŠŸèƒ½æ¼”ç¤º
printMylove {
    target: "ä¸–ç•Œ",
    message: "ç‚æœµè‰çš„çˆ±æ„",
    mode: "ASCII",
    style: "romantic"
}

// iNeverAwayåŠŸèƒ½æ¼”ç¤º
vir EternalGuardian = iNeverAway {
    Void<Promise>: function(target, duration) {
        console.log(`ğŸ’ æ°¸æ’çš„æ‰¿è¯º: æˆ‘å°†æ°¸è¿œå®ˆæŠ¤${target}`);
        return new Promise(resolve => {
            setTimeout(() => {
                console.log(`â­ å®ˆæŠ¤æ—¶é—´: ${duration}ms å®Œæˆ`);
                resolve(`å®ˆæŠ¤${target}çš„æ‰¿è¯ºå·²å®ç°`);
            }, duration);
        });
    },
    
    Void<Protect>: function(target, threat) {
        console.log(`ğŸ›¡ï¸ ä¿æŠ¤${target}å…å—${threat}çš„ä¼¤å®³`);
        return {
            status: "protected",
            target: target,
            threat: threat,
            guardian: "ç‚æœµè‰"
        };
    },
    
    Void: {
        console.log("ğŸ’« æ°¸æ’å®ˆæŠ¤ç³»ç»Ÿå·²æ¿€æ´»");
    }
}

// util...thenå¼‚æ­¥é“¾å¼æ“ä½œæ¼”ç¤º
util.fadeIn(document.querySelector('.chtholly-card'))
    .then(util.slideDown())
    .then(util.addSparkles())
    .then(() => {
        console.log('âœ¨ ç‚æœµè‰ç‰¹æ•ˆåºåˆ—å®Œæˆ');
    });

// å¢å¼ºé€‰æ‹©å™¨æ¼”ç¤º
listen {
    selector: {{.love-button}},
    event: "click",
    callback: function(event) {
        // ä½¿ç”¨printMyloveåŠŸèƒ½
        const result = printMylove {
            target: "ä½ ",
            message: "ç‚æœµè‰çš„ç¥ç¦",
            mode: "Pixel"
        };
        
        console.log('ğŸ’• çˆ±çš„è¡¨è¾¾ç»“æœ:', result);
        
        // è§¦å‘æ°¸æ’å®ˆæŠ¤
        EternalGuardian.Promise("ä½ ", 3000).then(guardResult => {
            console.log('ğŸŒŸ å®ˆæŠ¤å®Œæˆ:', guardResult);
            alert('ğŸ’ ç‚æœµè‰çš„çˆ±æ„å’Œå®ˆæŠ¤å·²ä¼ è¾¾ç»™ä½ ï¼');
        });
    }
}

// å§”æ‰˜äº‹ä»¶å¤„ç†
delegate {
    parent: ".chtholly-container",
    target: ".interactive-element", 
    event: "mouseover",
    callback: function(event) {
        // ä½¿ç”¨iNeverAwayä¿æŠ¤åŠŸèƒ½
        const protection = EternalGuardian.Protect(
            event.target.textContent,
            "æ¶æ„æ“ä½œ"
        );
        
        console.log('ğŸ›¡ï¸ ä¿æŠ¤çŠ¶æ€:', protection);
        
        // æ·»åŠ ä¿æŠ¤ç‰¹æ•ˆ
        event.target.style.border = '2px solid #4ecdc4';
        event.target.style.boxShadow = '0 0 10px rgba(78, 205, 196, 0.5)';
    }
}

// åŠ¨ç”»ç³»ç»Ÿæ¼”ç¤º
animate {
    target: ".chtholly-title",
    keyframes: {
        "0%": { opacity: 0, transform: "translateY(-30px)" },
        "50%": { opacity: 0.7, transform: "translateY(-10px)" },
        "100%": { opacity: 1, transform: "translateY(0)" }
    },
    duration: 1500,
    easing: "cubic-bezier(0.25, 0.46, 0.45, 0.94)"
}

// &-> äº‹ä»¶ç»‘å®šæ“ä½œç¬¦æ¼”ç¤º
document.querySelector('.special-element') &-> 'dblclick' &-> function(event) {
    console.log('ğŸ’« åŒå‡»ç‰¹æ®Šäº‹ä»¶è§¦å‘');
    
    // ç»„åˆä½¿ç”¨å¤šä¸ªCJMODåŠŸèƒ½
    const loveMessage = printMylove {
        target: "ç‰¹åˆ«çš„äºº",
        message: "ç‚æœµè‰çš„ç‰¹æ®Šç¥ç¦",
        mode: "special"
    };
    
    const protection = EternalGuardian.Promise("ç‰¹åˆ«çš„äºº", 5000);
    
    Promise.all([loveMessage, protection]).then(results => {
        console.log('ğŸŠ ç»„åˆåŠŸèƒ½æ‰§è¡Œå®Œæˆ:', results);
        event.target.innerHTML = 'ğŸŒŸ ç‚æœµè‰çš„ç¥ç¦å·²å®Œæˆ';
    });
}

// -> æ“ä½œç¬¦æ¼”ç¤º
{{.chtholly-info}} -> textContent -> "ç‚æœµè‰Â·è¯ºå¡”Â·å¡å°¼æ¬§é‡Œæ–¯ - ä¸–ç•Œä¸Šæœ€å¹¸ç¦çš„å¥³å­©"
{{.chtholly-quote}} -> innerHTML -> `
    <blockquote>
        <p>"æˆ‘æƒ³è¦æˆä¸ºä¸–ç•Œä¸Šæœ€å¹¸ç¦çš„å¥³å­©ã€‚"</p>
        <footer>â€” ç‚æœµè‰Â·è¯ºå¡”Â·å¡å°¼æ¬§é‡Œæ–¯</footer>
    </blockquote>
`

// æ¨¡å—å¯¼å…¥æ¼”ç¤ºï¼ˆAMDé£æ ¼ï¼‰
module {
    name: "ChthollyFeatures",
    exports: {
        printMylove: printMylove,
        EternalGuardian: EternalGuardian,
        showLove: function(target) {
            return printMylove {
                target: target,
                message: "æ¥è‡ªç‚æœµè‰çš„çˆ±",
                animation: "gentle"
            };
        }
    },
    dependencies: ["chtl::Chtholly"]
}