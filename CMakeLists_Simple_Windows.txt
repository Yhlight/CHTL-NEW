cmake_minimum_required(VERSION 3.16)
project(CHTL_Simple_Windows)

# 交叉编译设置
set(CMAKE_SYSTEM_NAME Windows)
set(CMAKE_C_COMPILER x86_64-w64-mingw32-gcc)
set(CMAKE_CXX_COMPILER x86_64-w64-mingw32-g++)

# C++17标准
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# UTF-8支持
add_compile_options(-finput-charset=UTF-8 -fexec-charset=UTF-8)

# 输出目录
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)

# 包含目录
include_directories(src)

# 简化的核心源文件（避免复杂依赖）
set(SIMPLE_SOURCES
    src/main.cpp
    src/CHTL/CHTLLexer/CHTLToken.cpp
    src/CHTL/CHTLLexer/CHTLLexer.cpp
    src/CHTL/CHTLParser/CHTLParser.cpp
    src/CHTL/CHTLGenerator/CHTLGenerator.cpp
    src/Scanner/CHTLUnifiedScanner.cpp
    src/CompilerDispatcher/CompilerDispatcher.cpp
)

# 创建简化的可执行文件
add_executable(chtl_simple ${SIMPLE_SOURCES})

# 静态链接
target_link_options(chtl_simple PRIVATE -static-libgcc -static-libstdc++)

# 设置为控制台应用程序
set_target_properties(chtl_simple PROPERTIES
    WIN32_EXECUTABLE FALSE
)

message(STATUS "简化Windows交叉编译配置完成")
message(STATUS "目标: chtl_simple.exe")
message(STATUS "编译器: MinGW-w64")