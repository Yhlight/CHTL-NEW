// CJMOD APIç»¼åˆå±•ç¤º
// å±•ç¤ºæ‰€æœ‰CJMOD APIçš„å¼ºå¤§åŠŸèƒ½ç»„åˆä½¿ç”¨
// ä¸¥æ ¼æŒ‰ç…§CJMOD.mdå®ç°

[Import] @CJmod from "comprehensive_api"
[Import] @CJmod from "advanced_placeholders"
[Import] @CJmod from "virtual_object_system"

[Configuration]
{
    CJMOD_DOUBLE_POINTER_SCAN = true;
    CJMOD_PREFIX_CUT_SCAN = true;
    CJMOD_SMART_SCAN = true;
    ENABLE_CONTEXT_DEDUCTION = true;
    CJMOD_VIR_SUPPORT = true;
    CJMOD_UNQUOTED_STRING_SUPPORT = true;
}

html
{
    head
    {
        title
        {
            text
            {
                CJMOD APIç»¼åˆåŠŸèƒ½å±•ç¤º
            }
        }
    }
    
    body
    {
        div
        {
            id: cjmod-showcase;
            class: api-showcase;
            
            text
            {
                ğŸ”¥ CJMOD - CHTLæä¸ºå¼ºå¤§çš„ç‰¹å¾å±•ç¤º
            }
            
            script
            {
                // ==========================================
                // 1. CJMOD Syntax API å®Œæ•´å±•ç¤º
                // ==========================================
                
                console.log('ğŸ”¥ CJMOD Syntax API å±•ç¤º');
                
                // è¯­æ³•åˆ†æèƒ½åŠ›
                vir mathSyntax = Syntax.analyze('$ ** $ + $ * $');
                console.log('å¤æ‚æ•°å­¦è¯­æ³•åˆ†æ:', mathSyntax);
                
                vir conditionalSyntax = Syntax.analyze('if $! then $!_ else $?_ finally $?_');
                console.log('æ¡ä»¶è¯­æ³•åˆ†æ:', conditionalSyntax);
                
                vir chainSyntax = Syntax.analyze('$ -> $ -> $ -> $');
                console.log('é“¾å¼è¯­æ³•åˆ†æ:', chainSyntax);
                
                // è¯­æ³•æ£€æµ‹èƒ½åŠ›
                console.log('å¯¹è±¡æ£€æµ‹:', Syntax.isObject('{name: "CHTL", version: "1.0"}'));
                console.log('å‡½æ•°æ£€æµ‹:', Syntax.isFunction('function calculate(x, y) { return x ** y; }'));
                console.log('æ•°ç»„æ£€æµ‹:', Syntax.isArray('[1, 2, 3, 4, 5]'));
                console.log('CHTL JSå‡½æ•°æ£€æµ‹:', Syntax.isCHTLJSFunction('calculate {base: $!, exp: $?}'));
                
                // ==========================================
                // 2. CJMOD Arg API å®Œæ•´å±•ç¤º
                // ==========================================
                
                console.log('\nğŸ”§ CJMOD Arg API å±•ç¤º');
                
                // åˆ›å»ºå¤æ‚å‚æ•°æ¨¡å¼
                vir complexArgs = Syntax.analyze('$!_ ** $?_ + $_ * ... - $!');
                
                // ç»‘å®šå¼ºå¤§çš„å¤„ç†å‡½æ•°
                complexArgs.bind('$!_', function(value) {
                    return value || 'defaultRequired';
                });
                
                complexArgs.bind('$?_', function(value) {
                    return value || 'defaultOptional';
                });
                
                complexArgs.bind('$_', function(value) {
                    return 'unordered:' + value;
                });
                
                complexArgs.bind('...', function(value) {
                    return 'variadic:[' + value + ']';
                });
                
                complexArgs.bind('$!', function(value) {
                    return 'required:' + value;
                });
                
                // ==========================================
                // 3. CJMOD Scanner API å®Œæ•´å±•ç¤º
                // ==========================================
                
                console.log('\nğŸ” CJMOD Scanner API å±•ç¤º');
                
                // åŒæŒ‡é’ˆæ‰«ææ³•æ¼”ç¤º
                vir doublePointerResult = CJMODScanner.scan(complexArgs, '**');
                console.log('åŒæŒ‡é’ˆæ‰«æç»“æœ:', doublePointerResult);
                
                // å‰ç½®æˆªå–æ³•æ¼”ç¤º
                vir prefixCutResult = CJMODScanner.scan(complexArgs, 'then');
                console.log('å‰ç½®æˆªå–ç»“æœ:', prefixCutResult);
                
                // æ™ºèƒ½æ‰«ææ¼”ç¤º
                vir smartScanResult = CJMODScanner.scan(complexArgs);
                console.log('æ™ºèƒ½æ‰«æç»“æœ:', smartScanResult);
                
                // ==========================================
                // 4. CJMOD Generator API å®Œæ•´å±•ç¤º
                // ==========================================
                
                console.log('\nâš¡ CJMOD Generator API å±•ç¤º');
                
                // å¡«å……æ‰«æç»“æœ
                complexArgs.fillValue(doublePointerResult);
                console.log('å¡«å……åå‚æ•°å€¼:');
                for (let i = 0; i < complexArgs.length; i++) {
                    console.log('  arg[' + i + '].value:', complexArgs[i].value);
                }
                
                // å¤æ‚è½¬æ¢
                complexArgs.transform(
                    'Math.pow(' + complexArgs[0].value + ', ' + complexArgs[2].value + ') + ' +
                    'Math.multiply(' + complexArgs[4].value + ', ' + complexArgs[6].value + ') - ' +
                    complexArgs[8].value
                );
                
                // å¯¼å‡ºæœ€ç»ˆä»£ç 
                vir finalJSCode = CJMODGenerator.exportResult(complexArgs);
                console.log('æœ€ç»ˆç”Ÿæˆçš„JSä»£ç :', finalJSCode);
                
                // ==========================================
                // 5. CHTLJSFunction API å®Œæ•´å±•ç¤º
                // ==========================================
                
                console.log('\nğŸŒ¸ CHTLJSFunction API å±•ç¤º');
                
                // åˆ›å»ºå¤šä¸ªå¼ºå¤§çš„CHTL JSå‡½æ•°
                vir mathFunc = CHTLJSFunction.CreateCHTLJSFunction(
                    'advancedMath {operation: $!_, operands: ..., precision: $?_, callback: $?_}'
                );
                
                vir dataFunc = CHTLJSFunction.CreateCHTLJSFunction(
                    'processAdvancedData {input: $!_, transform: $?_, validate: $?_, output: $!_}'
                );
                
                vir eventFunc = CHTLJSFunction.CreateCHTLJSFunction(
                    'handleComplexEvent {target: $!_, events: ..., options: $?_, callback: $?_}'
                );
                
                console.log('æ•°å­¦å‡½æ•°:', mathFunc.getFunctionName(), 'æ”¯æŒvir:', mathFunc.supportsVir());
                console.log('æ•°æ®å‡½æ•°:', dataFunc.getFunctionName(), 'æ”¯æŒvir:', dataFunc.supportsVir());
                console.log('äº‹ä»¶å‡½æ•°:', eventFunc.getFunctionName(), 'æ”¯æŒvir:', eventFunc.supportsVir());
                
                // æ‰‹åŠ¨ç»‘å®šæ›´å¤šè™šå¯¹è±¡æ”¯æŒ
                CHTLJSFunction.bindVirtualObject('customProcessor');
                CHTLJSFunction.bindVirtualObject('advancedCalculator');
                CHTLJSFunction.bindVirtualObject('intelligentAnalyzer');
                
                console.log('customProcessoræ”¯æŒvir:', CHTLJSFunction.supportsVirtualObject('customProcessor'));
                console.log('advancedCalculatoræ”¯æŒvir:', CHTLJSFunction.supportsVirtualObject('advancedCalculator'));
                console.log('intelligentAnalyzeræ”¯æŒvir:', CHTLJSFunction.supportsVirtualObject('intelligentAnalyzer'));
                
                // ==========================================
                // 6. ç»¼åˆä½¿ç”¨æ¼”ç¤º
                // ==========================================
                
                {{.api-showcase}} -> click {
                    console.log('ğŸš€ CJMOD APIç»¼åˆä½¿ç”¨æ¼”ç¤º');
                    
                    // æ­¥éª¤1: è¯­æ³•åˆ†æ
                    vir pattern = Syntax.analyze('$ -> $ -> $ then $');
                    
                    // æ­¥éª¤2: ç»‘å®šå‡½æ•°
                    pattern.bind('$', function(value) { return value; });
                    pattern.bind('->', function(value) { return '.then'; });
                    pattern.bind('then', function(value) { return '.finally'; });
                    
                    // æ­¥éª¤3: æ‰«æï¼ˆåŒæŒ‡é’ˆ+å‰ç½®æˆªå–ï¼‰
                    vir scanResult1 = CJMODScanner.scan(pattern, '->');  // åŒæŒ‡é’ˆæ‰«æ
                    vir scanResult2 = CJMODScanner.scan(pattern, 'then'); // å‰ç½®æˆªå–
                    
                    // æ­¥éª¤4: å¡«å……å’Œè½¬æ¢
                    pattern.fillValue(scanResult1);
                    pattern.transform('Promise.resolve(' + pattern[0].value + ')' +
                                    pattern[1].value + '(' + pattern[2].value + ')' +
                                    pattern[3].value + '(' + pattern[4].value + ')' +
                                    pattern[5].value + '(' + pattern[6].value + ')');
                    
                    // æ­¥éª¤5: å¯¼å‡º
                    vir result = CJMODGenerator.exportResult(pattern);
                    console.log('ç»¼åˆä½¿ç”¨ç»“æœ:', result);
                    
                    // æ­¥éª¤6: ä½¿ç”¨å¤©ç„¶æ”¯æŒvirçš„å‡½æ•°
                    vir finalResult = advancedMath({
                        operation: power,
                        operands: [2, 3, 4],
                        precision: 2,
                        callback: function(result) {
                            console.log('è®¡ç®—å®Œæˆ:', result);
                        }
                    });
                    
                    console.log('ğŸ‰ CJMOD APIç»¼åˆæ¼”ç¤ºå®Œæˆï¼');
                }
            }
            
            style
            {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 50px;
                border-radius: 25px;
                box-shadow: 0 20px 60px rgba(102, 126, 234, 0.5);
                color: white;
                text-align: center;
                position: relative;
                overflow: hidden;
                
                .api-showcase {
                    font-size: 28px;
                    font-weight: bold;
                    margin-bottom: 30px;
                    text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
                }
                
                &:before {
                    content: '';
                    position: absolute;
                    top: -50%;
                    left: -50%;
                    width: 200%;
                    height: 200%;
                    background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.1), transparent);
                    animation: rotate 4s linear infinite;
                }
                
                @keyframes rotate {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                
                & {
                    transition: all 0.6s ease;
                    cursor: pointer;
                }
                
                &:hover {
                    transform: translateY(-20px) scale(1.05);
                    box-shadow: 0 40px 100px rgba(102, 126, 234, 0.7);
                }
            }
        }
    }
}