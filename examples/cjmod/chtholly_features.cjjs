// CJMODå¼ºå¤§ç‰¹å¾æ¼”ç¤º - ç‚æœµè‰åŠŸèƒ½
// å±•ç¤ºCJMODæä¸ºå¼ºå¤§çš„C++ APIæ‰©å±•èƒ½åŠ›

// printMylove - çˆ±çš„è¡¨è¾¾åŠŸèƒ½
printMylove {
    target: "ä¸–ç•Œ",
    message: "æˆ‘æ°¸è¿œçˆ±ä½ ï¼Œç‚æœµè‰",
    style: "romantic",
    animation: "heartbeat"
}

// iNeverAway - æ°¸æ’å®ˆæŠ¤åŠŸèƒ½
vir EternalGuardian = iNeverAway {
    Void<Promise>: function(target, duration) {
        console.log(`ğŸ’ æ°¸æ’çš„æ‰¿è¯º: æˆ‘å°†æ°¸è¿œå®ˆæŠ¤${target}`);
        return new Promise(resolve => {
            setTimeout(() => {
                console.log(`â­ å®ˆæŠ¤æ—¶é—´: ${duration}ms å®Œæˆ`);
                resolve(`å®ˆæŠ¤${target}çš„æ‰¿è¯ºå·²å®ç°`);
            }, duration);
        });
    },
    
    Void<Protect>: function(target, threat) {
        console.log(`ğŸ›¡ï¸ ä¿æŠ¤${target}å…å—${threat}çš„ä¼¤å®³`);
        return {
            status: "protected",
            target: target,
            threat: threat,
            guardian: "ç‚æœµè‰"
        };
    },
    
    Void: {
        console.log("ğŸ’« æ°¸æ’å®ˆæŠ¤ç³»ç»Ÿå·²æ¿€æ´»");
    }
}

// util...then - å¼‚æ­¥é“¾å¼æ“ä½œ
util.fadeIn(document.querySelector('.chtholly-card'))
    .then(util.slideDown())
    .then(util.addSparkles())
    .then(() => {
        console.log('âœ¨ ç‚æœµè‰ç‰¹æ•ˆåºåˆ—å®Œæˆ');
    });

// å¢å¼ºé€‰æ‹©å™¨åŠŸèƒ½
listen {
    selector: {{.chtholly-button[data-action="love"]}},
    event: "click",
    callback: function(event) {
        // è°ƒç”¨printMyloveåŠŸèƒ½
        const result = printMylove {
            target: event.target.dataset.target || "ä½ ",
            message: "ç‚æœµè‰çš„çˆ±æ„ä¼ è¾¾ç»™äº†ä½ ",
            animation: "sparkle"
        };
        
        console.log('ğŸ’• çˆ±çš„è¡¨è¾¾ç»“æœ:', result);
        
        // è§¦å‘æ°¸æ’å®ˆæŠ¤
        EternalGuardian.Promise(event.target.dataset.target, 2000)
            .then(result => {
                console.log('ğŸŒŸ å®ˆæŠ¤å®Œæˆ:', result);
                
                // æ˜¾ç¤ºç‰¹æ•ˆ
                event.target.style.background = 'linear-gradient(45deg, #ff6b6b, #ffd93d)';
                event.target.textContent = 'ğŸ’ çˆ±å·²ä¼ è¾¾';
            });
    }
}

// å§”æ‰˜äº‹ä»¶å¤„ç†
delegate {
    parent: ".chtholly-container",
    target: ".dynamic-element",
    event: "mouseover",
    callback: function(event) {
        // ä½¿ç”¨iNeverAwayä¿æŠ¤åŠŸèƒ½
        const protection = EternalGuardian.Protect(
            event.target.textContent, 
            "æ¶æ„æ“ä½œ"
        );
        
        console.log('ğŸ›¡ï¸ ä¿æŠ¤çŠ¶æ€:', protection);
        
        // æ·»åŠ ä¿æŠ¤ç‰¹æ•ˆ
        event.target.style.border = '2px solid #4ecdc4';
        event.target.style.boxShadow = '0 0 10px rgba(78, 205, 196, 0.5)';
    }
}

// åŠ¨ç”»ç³»ç»Ÿ
animate {
    target: ".chtholly-title",
    keyframes: {
        "0%": { opacity: 0, transform: "translateY(-30px)" },
        "50%": { opacity: 0.7, transform: "translateY(-10px)" },
        "100%": { opacity: 1, transform: "translateY(0)" }
    },
    duration: 1500,
    easing: "cubic-bezier(0.25, 0.46, 0.45, 0.94)",
    callback: function() {
        console.log('ğŸŒ¸ ç‚æœµè‰æ ‡é¢˜åŠ¨ç”»å®Œæˆ');
        
        // é“¾å¼åŠ¨ç”»
        animate {
            target: ".chtholly-subtitle",
            keyframes: {
                "0%": { opacity: 0, transform: "scale(0.8)" },
                "100%": { opacity: 1, transform: "scale(1)" }
            },
            duration: 800,
            delay: 200
        }
    }
}

// &-> äº‹ä»¶ç»‘å®šæ“ä½œç¬¦æ¼”ç¤º
document.querySelector('.chtholly-special') &-> 'dblclick' &-> function(event) {
    console.log('ğŸ’« åŒå‡»ç‰¹æ®Šäº‹ä»¶è§¦å‘');
    
    // ç»„åˆä½¿ç”¨å¤šä¸ªCJMODåŠŸèƒ½
    const loveMessage = printMylove {
        target: "ç‰¹åˆ«çš„äºº",
        message: "ç‚æœµè‰çš„ç‰¹æ®Šç¥ç¦",
        mode: "special"
    };
    
    const protection = EternalGuardian.Promise("ç‰¹åˆ«çš„äºº", 5000);
    
    Promise.all([loveMessage, protection]).then(results => {
        console.log('ğŸŠ ç»„åˆåŠŸèƒ½æ‰§è¡Œå®Œæˆ:', results);
        
        // æ˜¾ç¤ºå®Œæˆæ•ˆæœ
        event.target.innerHTML = 'ğŸŒŸ ç‚æœµè‰çš„ç¥ç¦å·²å®Œæˆ';
        event.target.style.background = 'linear-gradient(45deg, #ff6b6b, #4ecdc4, #ffd93d)';
    });
}

// -> æ“ä½œç¬¦æ¼”ç¤º
{{.chtholly-info}} -> textContent -> "ç‚æœµè‰Â·è¯ºå¡”Â·å¡å°¼æ¬§é‡Œæ–¯ - ä¸–ç•Œä¸Šæœ€å¹¸ç¦çš„å¥³å­©"
{{.chtholly-quote}} -> innerHTML -> `
    <blockquote>
        <p>"æˆ‘æƒ³è¦æˆä¸ºä¸–ç•Œä¸Šæœ€å¹¸ç¦çš„å¥³å­©ã€‚"</p>
        <footer>â€” ç‚æœµè‰Â·è¯ºå¡”Â·å¡å°¼æ¬§é‡Œæ–¯</footer>
    </blockquote>
`

// æ¨¡å—å¯¼å…¥æ¼”ç¤ºï¼ˆAMDé£æ ¼ï¼‰
module {
    name: "ChthollyFeatures",
    exports: {
        printMylove: printMylove,
        EternalGuardian: EternalGuardian,
        showLove: function(target) {
            return printMylove {
                target: target,
                message: "æ¥è‡ªç‚æœµè‰çš„çˆ±",
                animation: "gentle"
            };
        }
    },
    dependencies: ["chtl::Chtholly"]
}