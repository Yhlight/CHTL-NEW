// CJMODé«˜çº§åŠŸèƒ½æ¼”ç¤º
// å±•ç¤ºCJMOD APIçš„æ‰€æœ‰å¼ºå¤§ç‰¹å¾
// ä¸¥æ ¼æŒ‰ç…§CJMOD.mdå’Œå››ä¸ªåŸºæœ¬æ–‡æ¡£å®ç°

[Import] @CJmod from "advanced_math_operations"
[Import] @CJmod from "enhanced_selectors"  
[Import] @CJmod from "virtual_object_system"

[Configuration]
{
    DISABLE_STYLE_AUTO_ADD_CLASS = false;
    DISABLE_STYLE_AUTO_ADD_ID = false;
    DISABLE_SCRIPT_AUTO_ADD_CLASS = true;
    DISABLE_SCRIPT_AUTO_ADD_ID = true;
    ENABLE_CONTEXT_DEDUCTION = true;
    CJMOD_DOUBLE_POINTER_SCAN = true;
    CJMOD_PREFIX_CUT_SCAN = true;
}

html
{
    head
    {
        title
        {
            text
            {
                CJMODé«˜çº§åŠŸèƒ½å®Œæ•´æ¼”ç¤º
            }
        }
    }
    
    body
    {
        div
        {
            id: cjmod-advanced-demo;
            class: cjmod-container;
            
            text
            {
                ğŸ”¥ CJMOD APIå¼ºå¤§åŠŸèƒ½å±•ç¤º
            }
            
            script
            {
                // 1. ä½¿ç”¨CJMODçš„Syntax::analyzeè¿›è¡Œè¯­æ³•åˆ†æ
                // è¿™äº›è¯­æ³•ä¼šè¢«CJMODçš„åŒæŒ‡é’ˆæ‰«ææ³•æˆ–å‰ç½®æˆªå–æ³•å¤„ç†
                
                // æ•°å­¦è¿ç®—æ‰©å±•ï¼ˆä½¿ç”¨$å ä½ç¬¦ï¼‰
                let result1 = $ ** $;  // CJMODä¼šåˆ†æå¹¶è½¬æ¢
                let result2 = $ + $ * $;  // å¤æ‚è¡¨è¾¾å¼
                let result3 = pow($!, $?);  // å¿…é¡»å‚æ•°å’Œå¯é€‰å‚æ•°
                
                // ä½¿ç”¨$!_ï¼ˆå¿…é¡»æ— åºå ä½ç¬¦ï¼‰å’Œ$?_ï¼ˆå¯é€‰æ— åºå ä½ç¬¦ï¼‰
                calculateAdvanced({
                    base: $!_,      // å¿…é¡»æ— åºå‚æ•°
                    exponent: $?_,  // å¯é€‰æ— åºå‚æ•°
                    precision: $?_  // å¦ä¸€ä¸ªå¯é€‰æ— åºå‚æ•°
                });
                
                // ä½¿ç”¨...ï¼ˆä¸å®šå‚æ•°å ä½ç¬¦ï¼‰
                sumAll(...);  // æ¥å—ä»»æ„æ•°é‡çš„å‚æ•°
                
                // 2. ä½¿ç”¨CHTLJSFunctionåˆ›å»ºçš„å¼ºå¤§å‡½æ•°
                // è¿™äº›å‡½æ•°å¤©ç„¶æ”¯æŒvirè™šå¯¹è±¡å’Œæ— ä¿®é¥°å­—ç¬¦ä¸²
                
                printMyLove({
                    url: https://chtl.example.com,  // æ— ä¿®é¥°å­—ç¬¦ä¸²
                    mode: auto,                     // æ— ä¿®é¥°å­—ç¬¦ä¸²
                    message: ç‚æœµè‰çš„çˆ±æ„ä¼ é€’       // UTF-8ä¸­æ–‡æ”¯æŒ
                });
                
                // å¤©ç„¶æ”¯æŒvirè™šå¯¹è±¡
                vir loveResult = printMyLove({
                    url: https://love.example.com,
                    mode: romantic,
                    intensity: maximum
                });
                
                vir mathResult = calculateAdvanced({
                    base: 2,
                    exponent: 10,
                    precision: 2
                });
                
                // 3. CJMODå¢å¼ºçš„é€‰æ‹©å™¨åŠŸèƒ½
                // ä½¿ç”¨{{CSSé€‰æ‹©å™¨}}è¯­æ³•
                
                {{.cjmod-container}} -> click {
                    console.log('ğŸ”¥ CJMODå¢å¼ºé€‰æ‹©å™¨ç‚¹å‡»');
                    console.log('æ•°å­¦ç»“æœ1:', result1);
                    console.log('æ•°å­¦ç»“æœ2:', result2);
                    console.log('è™šå¯¹è±¡ç»“æœ:', loveResult);
                }
                
                {{#cjmod-advanced-demo}} -> mouseenter {
                    // ä½¿ç”¨CJMODçš„åŠ¨ç”»API
                    animate.fadeIn({{.highlight}}, 300);
                    animate.slideUp({{.info}}, 500);
                }
                
                {{#cjmod-advanced-demo}} -> mouseleave {
                    animate.fadeOut({{.highlight}}, 200);
                    animate.slideDown({{.info}}, 400);
                }
                
                // 4. CJMODçš„äº‹ä»¶å§”æ‰˜åŠŸèƒ½
                delegate({{.dynamic-button}}, 'click', function(event) {
                    console.log('ğŸ¯ CJMODäº‹ä»¶å§”æ‰˜è§¦å‘');
                    
                    // ä½¿ç”¨CJMODè¯­æ³•æ£€æµ‹
                    if (Syntax.isObject(event.target.dataset)) {
                        console.log('âœ… æ£€æµ‹åˆ°æœ‰æ•ˆå¯¹è±¡');
                    }
                    
                    if (Syntax.isCHTLJSFunction('customAction {param: $!, mode: $?}')) {
                        console.log('âœ… æ£€æµ‹åˆ°CHTL JSå‡½æ•°è¯­æ³•');
                    }
                });
                
                // 5. CJMODçš„listenå¢å¼ºç›‘å¬å™¨
                listen({{document}}, 'DOMContentLoaded', function() {
                    console.log('ğŸŒ¸ CJMODå¢å¼ºç›‘å¬å™¨ï¼šé¡µé¢åŠ è½½å®Œæˆ');
                    
                    // åˆ›å»ºåŠ¨æ€CHTL JSå‡½æ•°
                    vir dynamicFunc = createCHTLJSFunction('dynamicAction {data: $!_, callback: $?_}');
                    
                    // ä½¿ç”¨ä¸å®šå‚æ•°
                    vir allResults = combineResults(...);
                    
                    console.log('æ‰€æœ‰ç»“æœ:', allResults);
                });
                
                // 6. CJMODçš„->æ“ä½œç¬¦ï¼ˆäº‹ä»¶ç»‘å®šæ“ä½œç¬¦ï¼‰
                {{.advanced-feature}} -> {
                    click: function() {
                        console.log('ç‚¹å‡»äº‹ä»¶');
                    },
                    hover: function() {
                        console.log('æ‚¬åœäº‹ä»¶');
                    },
                    focus: function() {
                        console.log('èšç„¦äº‹ä»¶');
                    }
                }
                
                // 7. CJMODçš„&->æ“ä½œç¬¦ï¼ˆäº‹ä»¶ç»‘å®šæ“ä½œç¬¦ï¼‰
                {{.special-element}} &-> {
                    'custom:event': function(data) {
                        console.log('è‡ªå®šä¹‰äº‹ä»¶:', data);
                    }
                }
            }
            
            style
            {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 40px;
                border-radius: 20px;
                box-shadow: 0 15px 50px rgba(0,0,0,0.2);
                color: white;
                text-align: center;
                
                .cjmod-container {
                    font-size: 24px;
                    font-weight: bold;
                    margin-bottom: 30px;
                }
                
                // & å¼•ç”¨é€‰æ‹©å™¨ä¼˜å…ˆé€‰æ‹©class
                & {
                    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                    position: relative;
                    overflow: hidden;
                }
                
                &:before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: -100%;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    transition: left 0.5s;
                }
                
                &:hover:before {
                    left: 100%;
                }
                
                &:hover {
                    transform: translateY(-10px) scale(1.02);
                    box-shadow: 0 25px 70px rgba(0,0,0,0.3);
                }
            }
        }
        
        div
        {
            class: feature-showcase;
            
            text
            {
                CJMODå ä½ç¬¦ç±»å‹å±•ç¤º
            }
            
            script
            {
                // å±•ç¤ºæ‰€æœ‰CJMODå ä½ç¬¦ç±»å‹
                
                // $ - åŸºæœ¬å ä½ç¬¦
                basicOperation($, $);
                
                // $? - å¯é€‰å ä½ç¬¦
                optionalOperation($, $?);
                
                // $! - å¿…é¡»å ä½ç¬¦
                requiredOperation($!);
                
                // $_ - æ— åºå ä½ç¬¦
                unorderedOperation({param1: $_, param2: $_});
                
                // $!_ - å¿…é¡»æ— åºå ä½ç¬¦
                requiredUnorderedOperation({required: $!_, optional: $?_});
                
                // ... - ä¸å®šå‚æ•°å ä½ç¬¦
                variadicOperation(...);
                
                // ç»„åˆä½¿ç”¨
                complexOperation({
                    required: $!_,
                    optional: $?_,
                    variadic: ...,
                    ordered: $!
                });
                
                {{.feature-showcase}} -> click {
                    console.log('ğŸ¯ æ‰€æœ‰CJMODå ä½ç¬¦ç±»å‹æ¼”ç¤ºå®Œæˆ');
                    console.log('âœ… $ - åŸºæœ¬å ä½ç¬¦');
                    console.log('âœ… $? - å¯é€‰å ä½ç¬¦'); 
                    console.log('âœ… $! - å¿…é¡»å ä½ç¬¦');
                    console.log('âœ… $_ - æ— åºå ä½ç¬¦');
                    console.log('âœ… $!_ - å¿…é¡»æ— åºå ä½ç¬¦');
                    console.log('âœ… ... - ä¸å®šå‚æ•°å ä½ç¬¦');
                }
            }
            
            style
            {
                background: #f8f9fa;
                border: 3px solid #007bff;
                border-radius: 15px;
                padding: 30px;
                margin: 30px 0;
                cursor: pointer;
                
                .feature-showcase {
                    color: #007bff;
                    font-size: 20px;
                    font-weight: bold;
                }
                
                &:hover {
                    border-color: #0056b3;
                    background: #e3f2fd;
                    transform: scale(1.05);
                }
            }
        }
        
        div
        {
            class: api-demonstration;
            
            text
            {
                CJMOD APIå®Œæ•´æ¼”ç¤º
            }
            
            script
            {
                // å®Œæ•´çš„CJMOD APIä½¿ç”¨æµç¨‹
                
                // 1. è¯­æ³•åˆ†æ
                vir syntaxPattern = Syntax.analyze('$ ** $');
                console.log('è¯­æ³•åˆ†æç»“æœ:', syntaxPattern);
                
                // 2. å‡½æ•°ç»‘å®š
                syntaxPattern.bind('$', function(value) {
                    return value;
                });
                
                syntaxPattern.bind('**', function(value) {
                    return value;
                });
                
                // 3. æ‰«æï¼ˆåŒæŒ‡é’ˆæ‰«ææ³•/å‰ç½®æˆªå–æ³•ï¼‰
                vir scanResult = CJMODScanner.scan(syntaxPattern, '**');
                console.log('æ‰«æç»“æœ:', scanResult);
                
                // 4. å¡«å……å€¼
                syntaxPattern.fillValue(scanResult);
                console.log('å¡«å……åçš„å€¼:', syntaxPattern);
                
                // 5. è½¬æ¢
                syntaxPattern.transform('pow(' + syntaxPattern[0].value + ', ' + syntaxPattern[2].value + ')');
                
                // 6. å¯¼å‡ºç»“æœ
                vir finalCode = CJMODGenerator.exportResult(syntaxPattern);
                console.log('æœ€ç»ˆç”Ÿæˆçš„JSä»£ç :', finalCode);
                
                {{.api-demonstration}} -> click {
                    console.log('ğŸš€ CJMOD APIå®Œæ•´æ¼”ç¤ºè§¦å‘');
                    console.log('å±•ç¤ºäº†CJMOD APIçš„å®Œæ•´å·¥ä½œæµç¨‹');
                }
            }
            
            style
            {
                background: linear-gradient(45deg, #ff6b6b, #ffa726);
                border-radius: 15px;
                padding: 30px;
                color: white;
                text-align: center;
                
                .api-demonstration {
                    font-size: 22px;
                    font-weight: bold;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                }
                
                &:hover {
                    background: linear-gradient(45deg, #ff5722, #ff9800);
                    transform: rotateY(5deg);
                }
            }
        }
    }
}